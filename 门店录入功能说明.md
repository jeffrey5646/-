# 门店录入功能说明

## ✅ 功能已完成

在"门店资源调度"页面新增了门店录入功能，录入的数据会自动同步到 Supabase 云端数据库。

---

## 🎯 使用方法

### 1. 打开门店管理页面
访问：http://localhost:3000/stores

### 2. 点击"新增门店"按钮
位于页面右上角，搜索框旁边

### 3. 填写门店信息

**必填字段：**
- **门店编码**：唯一标识，格式如 `N01-001`（自动转大写）
- **门店名称**：如 `上海南京路旗舰店`

**可选字段：**
- **门店地址**：完整地址
- **联系电话**：门店联系方式
- **纬度/经度**：用于地图定位
- **运营状态**：营业中 / 已关闭 / 异常

### 4. 确认创建
点击"确认创建"按钮，系统会：
- ✅ 验证编码格式（只能包含字母、数字、连字符）
- ✅ 检查编码是否重复
- ✅ 插入数据到 Supabase `stores` 表
- ✅ 自动刷新门店列表
- ✅ 实时同步到 App 端

---

## 📊 数据同步

### Supabase 表结构
```sql
CREATE TABLE stores (
  id UUID PRIMARY KEY,
  code TEXT UNIQUE NOT NULL,        -- 门店编码
  name TEXT NOT NULL,                -- 门店名称
  address TEXT,                      -- 地址
  contact_phone TEXT,                -- 联系电话
  status TEXT DEFAULT 'online',      -- 状态
  latitude NUMERIC(10,7),            -- 纬度
  longitude NUMERIC(10,7),           -- 经度
  manager_id UUID,                   -- 负责人（外键）
  last_score NUMERIC(5,2),           -- 最近评分
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

### 自动同步机制
1. **管理平台录入** → Supabase `stores` 表
2. **Supabase Realtime** → 自动推送更新
3. **App 端** → 通过 `useMyStores` Hook 实时获取

---

## 🔄 实时更新

页面已配置 Supabase Realtime 监听：
```typescript
const channel = supabase.channel('dashboard_realtime_sync')
  .on('postgres_changes', { event: '*', table: 'stores' }, fetchData)
  .on('postgres_changes', { event: '*', table: 'profiles' }, fetchData)
  .subscribe();
```

任何门店数据变更都会自动刷新列表，无需手动刷新页面。

---

## 🎨 UI 特性

- **现代化设计**：圆角卡片、渐变动画
- **表单验证**：实时检查必填项和格式
- **加载状态**：提交时显示加载动画
- **错误提示**：友好的错误消息
- **响应式布局**：适配不同屏幕尺寸

---

## 🧪 测试示例

### 测试数据 1
```
门店编码: N01-005
门店名称: 北京三里屯概念店
门店地址: 北京市朝阳区三里屯路19号
联系电话: 010-12345678
纬度: 39.9042
经度: 116.4074
运营状态: 营业中
```

### 测试数据 2
```
门店编码: N02-001
门店名称: 深圳华强北旗舰店
门店地址: 广东省深圳市福田区华强北路1号
联系电话: 0755-87654321
纬度: 22.5431
经度: 114.0579
运营状态: 营业中
```

---

## 🔍 验证方法

### 1. 在管理平台验证
创建后立即在列表中看到新门店

### 2. 在 Supabase 验证
打开 Supabase Dashboard → Table Editor → stores 表
查看新增的记录

### 3. 在 App 端验证
登录 App → 门店列表页面
新门店会自动出现（根据权限）

---

## ⚠️ 注意事项

1. **门店编码唯一性**
   - 编码不能重复
   - 建议使用统一格式：`区域-序号`

2. **权限控制**
   - 新建门店默认没有负责人
   - 需要在"员工档案中心"分配负责人
   - 分配后 App 端用户才能看到该门店

3. **数据完整性**
   - 必填字段不能为空
   - 经纬度必须是有效数字
   - 电话号码建议包含区号

---

## 🚀 后续优化建议

1. **批量导入**：支持 Excel/CSV 批量导入门店
2. **地图选点**：集成地图组件，点击选择经纬度
3. **图片上传**：支持上传门店照片
4. **区域管理**：按省市区域分组管理
5. **删除功能**：添加门店删除/停用功能

---

完成！现在可以在管理平台轻松录入门店，数据会自动同步到整个系统。🎉
